"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{6343:(e,a,t)=>{t.d(a,{A:()=>p});var d=t(1503),s=t(2223),r=t(2431),l=t(5293),i=t(3679),o=t(4577),n=t(1298),c=t(6693),m=t(6496),u=t(3503),h=t(7835),x=t(3572);function p(e){let{produto:a,onSubmit:t,onCancel:p,loading:v=!1,editingData:j}=e,[_,g]=(0,s.useState)([]),[N,b]=(0,s.useState)([]),[f,y]=(0,s.useState)([]),[w,S]=(0,s.useState)([]),[q,C]=(0,s.useState)(!1),[A,k]=(0,s.useState)(!1),[F,J]=(0,s.useState)(!1),[E,P]=(0,s.useState)(!1),[R,O]=(0,s.useState)({tipo_movimentacao:(null==j?void 0:j.tipo_movimentacao)||"entrada",cliente_id:(null==j?void 0:j.cliente_id)||"",fornecedor_id:(null==j?void 0:j.fornecedor_id)||"",vendedor_id:(null==j?void 0:j.vendedor_id)||"",observacoes:(null==j?void 0:j.observacoes)||""}),[T,$]=(0,s.useState)({produto_id:"",quantidade:1,preco_unitario:0,valor_total:0}),[z,B]=(0,s.useState)((null==j?void 0:j.produtos)?JSON.parse(j.produtos):[]);(0,s.useEffect)(()=>{Z()},[]),(0,s.useEffect)(()=>{let e=T.quantidade*T.preco_unitario;$(a=>({...a,valor_total:e}))},[T.quantidade,T.preco_unitario]);let Z=async()=>{await Promise.all([D(),M(),Q(),U()])},D=async()=>{try{C(!0);let e=await x.Aw.getAll(1,100);e.success&&e.data&&g(e.data)}catch(e){}finally{C(!1)}},M=async()=>{try{k(!0);let e=await x.pK.getAll(1,100);e.success&&e.data&&b(e.data)}catch(e){}finally{k(!1)}},Q=async()=>{try{J(!0);let e=await x.Rg.getAll(1,100);e.success&&e.data&&y(e.data)}catch(e){}finally{J(!1)}},U=async()=>{try{P(!0);let e=await x.tq.getAll(1,100);e.success&&e.data&&S(e.data)}catch(e){}finally{P(!1)}},V=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);return q||A||F||E?(0,d.jsx)(o.Zp,{className:"w-full max-w-2xl mx-auto",children:(0,d.jsxs)(o.Wu,{className:"flex items-center justify-center py-8",children:[(0,d.jsx)(n.A,{className:"h-8 w-8 animate-spin"}),(0,d.jsx)("span",{className:"ml-2",children:"Carregando dados..."})]})}):(0,d.jsxs)(o.Zp,{className:"w-full max-w-2xl mx-auto",children:[(0,d.jsx)(o.aR,{children:(0,d.jsxs)(o.ZB,{className:"flex items-center",children:["entrada"===R.tipo_movimentacao?(0,d.jsx)(c.A,{className:"mr-2 h-5 w-5 text-green-600"}):(0,d.jsx)(m.A,{className:"mr-2 h-5 w-5 text-red-600"}),j?"Editar":"Nova"," Movimenta\xe7\xe3o - ","entrada"===R.tipo_movimentacao?"Entrada":"Sa\xedda"]})}),(0,d.jsx)(o.Wu,{children:(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t({...R,produtos:JSON.stringify(z)})},className:"space-y-4",children:[(0,d.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[(0,d.jsx)("h4",{className:"font-medium mb-3",children:"Adicionar Produto"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)(i.J,{htmlFor:"produto_id",children:"Produto *"}),(0,d.jsxs)("select",{id:"produto_id",value:T.produto_id,onChange:e=>$(a=>({...a,produto_id:e.target.value})),className:"w-full p-2 border rounded-md",children:[(0,d.jsx)("option",{value:"",children:"Selecione um produto"}),_.map(e=>(0,d.jsxs)("option",{value:e.id,children:[e.nome," - Estoque: ",e.estoque]},e.id))]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(i.J,{htmlFor:"quantidade",children:"Quantidade *"}),(0,d.jsx)(l.p,{id:"quantidade",type:"number",min:"1",value:T.quantidade,onChange:e=>$(a=>({...a,quantidade:Number(e.target.value)})),placeholder:"1",className:"w-full"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(i.J,{htmlFor:"preco_unitario",children:"Pre\xe7o Unit. *"}),(0,d.jsx)(l.p,{id:"preco_unitario",type:"number",min:"0",step:"0.01",value:T.preco_unitario,onChange:e=>$(a=>({...a,preco_unitario:Number(e.target.value)})),placeholder:"0,00",className:"w-full"})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between mt-3 p-3 bg-white dark:bg-gray-700 rounded-md",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Total:"}),(0,d.jsx)("span",{className:"font-bold text-lg",children:V(T.valor_total)})]}),(0,d.jsx)(r.$,{type:"button",onClick:()=>{if(T.produto_id&&T.quantidade>0){let e=_.find(e=>e.id===Number(T.produto_id));if(e){let a={produto_id:Number(T.produto_id),quantidade:T.quantidade,preco_unitario:T.preco_unitario,valor_total:T.valor_total,produto_nome:e.nome};B(e=>[...e,a]),$({produto_id:"",quantidade:1,preco_unitario:0,valor_total:0})}}},disabled:!T.produto_id||T.quantidade<=0,className:"bg-green-600 hover:bg-green-700",children:"Adicionar Produto"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(i.J,{htmlFor:"tipo_movimentacao",children:"Tipo de Movimenta\xe7\xe3o *"}),(0,d.jsxs)("select",{id:"tipo_movimentacao",value:R.tipo_movimentacao,onChange:e=>O(a=>({...a,tipo_movimentacao:e.target.value,cliente_id:"",fornecedor_nome:"",vendedor_id:""})),className:"w-full p-2 border rounded-md",children:[(0,d.jsx)("option",{value:"entrada",children:"Entrada (Compra de Fornecedor)"}),(0,d.jsx)("option",{value:"saida",children:"Sa\xedda (Venda para Cliente)"})]})]}),"entrada"===R.tipo_movimentacao?(0,d.jsxs)("div",{children:[(0,d.jsx)(i.J,{htmlFor:"fornecedor_id",children:"Fornecedor *"}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(u.A,{className:"h-4 w-4 text-gray-500"}),(0,d.jsxs)("select",{id:"fornecedor_id",value:R.fornecedor_id,onChange:e=>O(a=>({...a,fornecedor_id:e.target.value})),className:"w-full p-2 border rounded-md",required:!0,children:[(0,d.jsx)("option",{value:"",children:"Selecione um fornecedor"}),w.map(e=>(0,d.jsxs)("option",{value:e.id,children:[e.nome," - ",e.email||e.telefone]},e.id))]})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(i.J,{htmlFor:"cliente_id",children:"Cliente *"}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(h.A,{className:"h-4 w-4 text-gray-500"}),(0,d.jsxs)("select",{id:"cliente_id",value:R.cliente_id,onChange:e=>O(a=>({...a,cliente_id:e.target.value})),className:"w-full p-2 border rounded-md",required:!0,children:[(0,d.jsx)("option",{value:"",children:"Selecione um cliente"}),N.map(e=>(0,d.jsxs)("option",{value:e.id,children:[e.nome," - ",e.email]},e.id))]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(i.J,{htmlFor:"vendedor_id",children:"Vendedor Respons\xe1vel"}),(0,d.jsxs)("select",{id:"vendedor_id",value:R.vendedor_id,onChange:e=>O(a=>({...a,vendedor_id:e.target.value})),className:"w-full p-2 border rounded-md",children:[(0,d.jsx)("option",{value:"",children:"Selecione um vendedor (opcional)"}),f.map(e=>(0,d.jsxs)("option",{value:e.id,children:[e.nome," - ",e.email]},e.id))]})]})]}),z.length>0&&(0,d.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[(0,d.jsx)("h4",{className:"font-medium mb-3",children:"Produtos Adicionados"}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"border-b",children:[(0,d.jsx)("th",{className:"text-left p-2",children:"Produto"}),(0,d.jsx)("th",{className:"text-left p-2",children:"Descri\xe7\xe3o"}),(0,d.jsx)("th",{className:"text-right p-2",children:"Pre\xe7o Unit."}),(0,d.jsx)("th",{className:"text-center p-2",children:"Quantidade"}),(0,d.jsx)("th",{className:"text-right p-2",children:"Total"}),(0,d.jsx)("th",{className:"text-center p-2",children:"A\xe7\xf5es"})]})}),(0,d.jsx)("tbody",{children:z.map((e,a)=>(0,d.jsxs)("tr",{className:"border-b hover:bg-gray-100 dark:hover:bg-gray-700",children:[(0,d.jsx)("td",{className:"p-2 font-medium",children:e.produto_id}),(0,d.jsx)("td",{className:"p-2",children:e.produto_nome}),(0,d.jsx)("td",{className:"p-2 text-right",children:V(e.preco_unitario)}),(0,d.jsx)("td",{className:"p-2 text-center",children:e.quantidade}),(0,d.jsx)("td",{className:"p-2 text-right font-medium",children:V(e.valor_total)}),(0,d.jsx)("td",{className:"p-2 text-center",children:(0,d.jsx)(r.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{B(e=>e.filter((e,t)=>t!==a))},className:"text-red-600 hover:text-red-700",children:"Remover"})})]},a))})]})}),(0,d.jsx)("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"font-medium",children:"Total Geral:"}),(0,d.jsx)("span",{className:"font-bold text-xl text-blue-600 dark:text-blue-400",children:V(z.reduce((e,a)=>e+a.valor_total,0))})]})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(i.J,{htmlFor:"observacoes",children:"Observa\xe7\xf5es"}),(0,d.jsx)("textarea",{id:"observacoes",value:R.observacoes,onChange:e=>O(a=>({...a,observacoes:e.target.value})),placeholder:"Observa\xe7\xf5es adicionais",className:"w-full p-2 border rounded-md h-20 resize-none"})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,d.jsx)(r.$,{type:"button",variant:"outline",onClick:p,disabled:v,children:"Cancelar"}),(0,d.jsx)(r.$,{type:"submit",disabled:v||0===z.length,className:"bg-meguispet-primary hover:bg-meguispet-primary/90",children:v?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):"".concat(j?"Atualizar":"Salvar"," ").concat("entrada"===R.tipo_movimentacao?"Entrada":"Sa\xedda")})]})]})})]})}}}]);